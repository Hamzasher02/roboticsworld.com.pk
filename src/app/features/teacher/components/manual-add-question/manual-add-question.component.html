<section class="w-full">

  <!-- Header Row -->
  <div class="mt-6 flex items-start justify-between gap-4">
    <div>
      <div class="text-[14px] font-semibold text-gray-900">Quiz Questions</div>
      <div class="mt-1 text-[11px] text-gray-500">Review, add, edit and delete questions</div>
    </div>

    <div class="flex items-center gap-3">
      <div class="inline-flex items-center rounded-full bg-gray-100 px-3 py-1 text-[11px] text-gray-600">
        {{ isFetchingQuestions ? 'Loading...' : questions.length + ' questions' }}
      </div>

      <button type="button" (click)="openAddQuestionModal()" [disabled]="isFetchingQuestions" class="inline-flex h-9 items-center gap-2 rounded-[8px] bg-[#2563EB] px-4 text-[11px] font-semibold text-white
               shadow-[0_1px_0_rgba(0,0,0,0.06)] hover:bg-[#1D4ED8] focus:outline-none focus:ring-4 focus:ring-blue-100
               disabled:opacity-60 disabled:cursor-not-allowed">
        <span class="text-[13px] leading-none">+</span>
        Add Question
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isFetchingQuestions" class="mt-5 flex items-center justify-center py-10">
    <div class="text-[12px] text-gray-500">Loading questions...</div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isFetchingQuestions && questions.length === 0"
    class="mt-5 flex flex-col items-center justify-center py-10 rounded-[10px] border border-gray-200 bg-gray-50">
    <div class="text-[14px] font-semibold text-gray-600">No questions yet</div>
    <div class="mt-1 text-[11px] text-gray-500">Click "Add Question" to create your first question</div>
  </div>

  <!-- Questions list -->
  <div *ngIf="!isFetchingQuestions && questions.length > 0" class="mt-5 flex flex-col gap-4">

    <article *ngFor="let q of questions; let i = index"
      class="rounded-[10px] border border-gray-200 bg-white p-4 shadow-[0_1px_0_rgba(0,0,0,0.03)]">
      <!-- top row -->
      <div class="flex items-start justify-between gap-3">
        <div class="min-w-0">
          <div class="text-[12px] font-semibold text-gray-900">{{ q.title }}</div>
          <div class="mt-1 text-[10px] leading-5 text-gray-600">
            {{ q.type === 'mcq' ? 'Multiple Choice' : q.type === 'truefalse' ? 'True/False' : 'Short Answer' }}
          </div>
        </div>

        <div class="flex items-center gap-1">
          <span
            class="inline-flex items-center rounded-full bg-[#FEF3C7] px-2 py-0.5 text-[9px] font-semibold text-[#92400E]">
            {{ q.difficulty }}
          </span>

          <span class="text-[10px] text-gray-400">{{ q.points }} pts</span>

          <div class="flex items-center">
            <!-- ✅ edit: ONLY for mcq (same modal ui) -->
            <button type="button" (click)="openEditQuestionModal(q, i)"
              class="inline-flex h-6 w-6 items-center justify-center rounded-md hover:bg-gray-50" aria-label="Edit"
              title="Edit">
              <img src="/assets/instructor-images/quiz/Vector (22).svg" alt="" class="h-3 w-3 object-contain" />
            </button>


            <!-- delete -->
            <button type="button" (click)="removeQuestion(i)"
              class="inline-flex h-6 w-6 items-center justify-center rounded-md hover:bg-red-50" aria-label="Delete"
              title="Delete">
              <img src="/assets/instructor-images/quiz/Vector (23).svg" alt="" class="h-3 w-3 object-contain" />
            </button>
          </div>
        </div>
      </div>

      <!-- MCQ options -->
      <div *ngIf="q.type === 'mcq'" class="mt-3 flex flex-col gap-2">
        <div *ngFor="let opt of q.options; let oi = index"
          class="flex items-start gap-2 rounded-[6px] border px-3 py-2 text-[10px]" [ngClass]="oi === getCorrectIndex(q)
            ? 'border-[#86EFAC] bg-[#ECFDF5] text-gray-900'
            : 'border-gray-200 bg-[#F9FAFB] text-gray-700'">
          <span class="mt-[1px] text-[10px] text-gray-500">{{ opt.label }}</span>

          <span class="flex flex-1 items-center justify-between gap-2">
            <span class="flex-1">{{ opt.text }}</span>
            <img *ngIf="oi === getCorrectIndex(q)" src="/assets/instructor-images/quiz/tick.svg" alt="Correct"
              class="h-2 w-2" />
          </span>
        </div>
      </div>

      <!-- True/False -->
      <div *ngIf="q.type === 'truefalse'" class="mt-3 flex items-center gap-2">
        <span class="inline-flex h-7 items-center gap-1 rounded-[6px] border px-3 text-[10px]"
          [ngClass]="q.options[0].correct ? 'border-[#86EFAC] bg-[#ECFDF5] text-gray-900' : 'border-gray-200 bg-white text-gray-700'">
          True
          <img *ngIf="q.options[0].correct" src="/assets/instructor-images/quiz/tick.svg" alt="" class="h-2 w-2" />
        </span>

        <span class="inline-flex h-7 items-center gap-1 rounded-[6px] border px-3 text-[10px]"
          [ngClass]="q.options[1].correct ? 'border-[#86EFAC] bg-[#ECFDF5] text-gray-900' : 'border-gray-200 bg-white text-gray-700'">
          False
          <img *ngIf="q.options[1].correct" src="/assets/instructor-images/quiz/tick.svg" alt="" class="h-2 w-2" />
        </span>
      </div>

      <!-- Short answer -->
      <div *ngIf="q.type === 'short'" class="mt-3">
        <input type="text" disabled value="Short answer input field"
          class="h-8 w-full rounded-[6px] border border-gray-200 bg-[#F9FAFB] px-3 text-[10px] text-gray-500" />
      </div>

      <!-- Explanation -->
      <div class="mt-3 rounded-[6px] border border-[#BFDBFE] bg-[#EFF6FF] px-3 py-2 text-[10px] text-[#1D4ED8]">
        <span class="font-semibold">Explanation:</span>
        {{ q.explanation }}
      </div>

      <div class="mt-2 text-[9px] text-gray-400">
        Source: {{ q.source }}
      </div>
    </article>
  </div>

  <!-- Bottom Actions -->
  <div class="mt-6 flex items-center justify-between">
    <button type="button" (click)="back.emit()" class="inline-flex h-10 items-center justify-center gap-2 rounded-[8px] border border-gray-200 bg-white px-5
             text-[12px] font-semibold text-gray-700 hover:bg-gray-50">
      ← Back
    </button>

    <button type="button" (click)="goNextSettings()" class="inline-flex h-10 items-center justify-center gap-2 rounded-[8px] bg-[#0EA5B7] px-6
             text-[12px] font-semibold text-white shadow-[0_10px_20px_rgba(14,165,183,0.18)]
             hover:bg-[#0C96A7] focus:outline-none focus:ring-4 focus:ring-sky-100">
      Next: Quiz Settings →
    </button>
  </div>

  <!-- ✅ Add/Edit Modal -->
  <div *ngIf="showAddQuestionModal"
    class="fixed inset-0 z-[2000] flex items-center justify-center bg-black/40 p-3 sm:p-4" role="dialog"
    aria-modal="true" [attr.aria-label]="isEditMode ? 'Question Editor' : 'Add a Question'">
    <div class="w-full max-w-[580px]">
      <div
        class="flex max-h-[92vh] flex-col overflow-hidden rounded-[10px] bg-white shadow-[0_18px_40px_rgba(0,0,0,0.20)]">

        <!-- Header -->
        <div class="shrink-0 px-6 py-4 sm:px-7 sm:py-5">
          <div class="text-[16px] font-semibold text-gray-900">
            {{ isEditMode ? 'Question Editor' : 'Add a Question' }}
          </div>
        </div>

        <!-- Body -->
        <div class="flex-1 overflow-y-auto px-6 pb-6 sm:px-7">

          <!-- Question -->
          <div>
            <label class="text-[12px] font-semibold text-gray-900">Question *</label>
            <textarea [(ngModel)]="addForm.title" rows="3" class="mt-2 w-full resize-none rounded-[8px] border border-gray-200 bg-white px-4 py-3 text-[12px] text-gray-800
                     placeholder:text-gray-400 focus:outline-none focus:ring-4 focus:ring-blue-100"
              placeholder="Enter your question here..."></textarea>
          </div>

          <!-- Answer Options -->
          <div class="mt-5">
            <div class="text-[12px] font-semibold text-gray-900">Answer Options</div>

            <div class="mt-3 flex flex-col gap-3">
              <div *ngFor="let opt of addForm.options; let i = index; trackBy: trackByIndex"
                class="flex items-center gap-3">
                <!-- radio -->
                <button type="button" (click)="setCorrect(i)"
                  class="inline-flex h-4 w-4 items-center justify-center rounded-full border"
                  [ngClass]="addForm.correctIndex === i ? 'border-[#2563EB] bg-[#2563EB]' : 'border-gray-300 bg-white'"
                  aria-label="Select correct option">
                  <span class="h-2 w-2 rounded-full bg-white"
                    [ngClass]="addForm.correctIndex === i ? '' : 'opacity-0'"></span>
                </button>

                <input [ngModel]="addForm.options[i]" (ngModelChange)="updateOption(i, $event)" type="text" class="h-10 w-full rounded-[8px] border border-gray-200 bg-white px-4 text-[12px] text-gray-800
                         placeholder:text-gray-400 focus:outline-none focus:ring-4 focus:ring-blue-100"
                  [placeholder]="'Option ' + getOptionLabel(i)" />
              </div>
            </div>
          </div>

          <!-- Points / Difficulty / Correct Answer -->
          <div class="mt-5 flex flex-col gap-4 sm:flex-row">
            <div class="w-full sm:flex-1">
              <label class="text-[12px] font-semibold text-gray-900">Points</label>
              <input [(ngModel)]="addForm.points" type="number" min="1" class="mt-2 h-10 w-full rounded-[8px] border border-gray-200 bg-white px-4 text-[12px] text-gray-800
                       focus:outline-none focus:ring-4 focus:ring-blue-100" />
            </div>

            <div class="w-full sm:flex-1">
              <label class="text-[12px] font-semibold text-gray-900">Difficulty</label>
              <select [(ngModel)]="addForm.difficulty" class="mt-2 h-10 w-full rounded-[8px] border border-gray-200 bg-white px-4 text-[12px] text-gray-800
                       focus:outline-none focus:ring-4 focus:ring-blue-100">
                <option value="Easy">Easy</option>
                <option value="Medium">Medium</option>
                <option value="Hard">Hard</option>
              </select>
            </div>

            <div class="w-full sm:flex-1">
              <label class="text-[12px] font-semibold text-gray-900">Correct Answer <span
                  class="text-red-500">*</span></label>
              <select [(ngModel)]="addForm.correctIndex" class="mt-2 h-10 w-full rounded-[8px] border border-gray-200 bg-white px-4 text-[12px] text-gray-800
                       focus:outline-none focus:ring-4 focus:ring-blue-100">
                <option *ngFor="let opt of addForm.options; let i = index" [ngValue]="i">
                  Option {{ getOptionLabel(i) }}
                </option>
              </select>
            </div>
          </div>

          <!-- Explanation -->
          <div class="mt-5">
            <label class="text-[12px] font-semibold text-gray-900">Explanation (Optional)</label>
            <textarea [(ngModel)]="addForm.explanation" rows="2" class="mt-2 w-full resize-none rounded-[8px] border border-gray-200 bg-white px-4 py-3 text-[12px] text-gray-800
                     placeholder:text-gray-400 focus:outline-none focus:ring-4 focus:ring-blue-100"
              placeholder="Explain why this is the correct answer..."></textarea>
          </div>

        </div>

        <!-- Footer -->
        <div class="shrink-0 border-t border-gray-100 bg-white px-6 py-4 sm:px-7">
          <div class="flex items-center justify-end gap-4">
            <button type="button" (click)="closeAddQuestionModal()" class="inline-flex h-10 items-center justify-center rounded-[10px] bg-[#6B7280] px-10 text-[12px] font-semibold text-white
                     hover:bg-[#5B6472] focus:outline-none focus:ring-4 focus:ring-gray-200">
              Cancel
            </button>

            <button type="button" (click)="confirmQuestionModal()"
              class="inline-flex h-10 items-center justify-center gap-2 rounded-[10px] bg-[#2563EB] px-10 text-[12px] font-semibold text-white
                     shadow-[0_1px_0_rgba(0,0,0,0.06)] hover:bg-[#1D4ED8] focus:outline-none focus:ring-4 focus:ring-blue-100">
              <span class="text-[14px] leading-none" *ngIf="!isEditMode">+</span>
              {{ isEditMode ? 'Edit Question' : 'Add Question' }}
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>
</section>