<!-- quiz-overview.component.html -->
<!-- Page Wrapper -->
<section class="min-h-screen bg-white px-4 py-6">
  <div class="mx-auto w-full max-w-[1200px]">

    <!-- Header Card -->
    <div class="overflow-hidden rounded-[10px] bg-gradient-to-r from-[#8A3FFC] to-[#3F5EF6]">
      <div class="flex items-center gap-4 px-6 py-5">
        <!-- Back Icon -->
        <button
          type="button"
          aria-label="Back"
          (click)="goBack()"
          class="flex h-9 w-9 cursor-pointer items-center justify-center rounded-full
                 hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/40"
        >
          <img [src]="header.backIcon" alt="Back" class="h-5 w-5" />
        </button>

        <!-- Title -->
        <div class="min-w-0">
          <h1 class="text-[18px] font-semibold text-white">{{ header.title }}</h1>
          <p class="mt-0.5 text-[12px] text-white/80">{{ header.subtitle }}</p>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="mt-6 border-b border-gray-200">
      <nav class="flex flex-wrap gap-6 text-[13px] font-medium">
        <button
          *ngFor="let t of tabs; let i = index"
          type="button"
          (click)="setActiveTab(i)"
          class="relative flex cursor-pointer items-center gap-2 pb-3 transition-colors duration-150
                 hover:text-[#8A3FFC] focus:outline-none focus:ring-2 focus:ring-[#8A3FFC]/25 rounded-[4px]"
          [ngClass]="t.active ? 'text-[#8A3FFC]' : 'text-gray-500'"
        >
          <img [src]="t.active ? t.activeIcon : t.icon" alt="" class="h-3 w-3" />
          <span>{{ t.label }}</span>

          <span
            *ngIf="t.active"
            class="absolute bottom-0 left-0 h-[2px] w-full bg-[#8A3FFC]"
          ></span>
        </button>
      </nav>
    </div>

    <!-- ========================= OVERVIEW TAB ========================= -->
    <ng-container *ngIf="activeTabKey === 'overview'">
      <!-- Stat Cards -->
      <div class="mt-6 flex flex-col gap-4 sm:flex-row sm:flex-wrap lg:flex-row">
        <div
          *ngFor="let stat of stats"
          class="flex w-full items-center justify-between rounded-[10px] px-5 py-4 sm:w-[calc(50%-8px)] lg:w-[calc(25%-12px)]"
          [ngClass]="stat.bg"
        >
          <div>
            <p class="text-[12px] font-medium" [ngClass]="stat.text">{{ stat.label }}</p>
            <p class="mt-1 text-[22px] font-semibold" [ngClass]="stat.valueColor">{{ stat.value }}</p>
          </div>
          <img [src]="stat.icon" [alt]="stat.label" class="h-10 w-10" />
        </div>
      </div>

      <!-- Bottom Section -->
      <div class="mt-6 flex flex-col gap-6 lg:flex-row">
        <!-- Quiz Information -->
        <article class="w-full rounded-[10px] bg-white px-6 py-5 shadow-[0_8px_24px_rgba(0,0,0,0.08)] lg:w-1/2">
          <h2 class="text-[14px] font-semibold text-gray-900">Quiz Information</h2>
          <dl class="mt-4 space-y-3 text-[13px]">
            <div *ngFor="let row of quizInfo" class="flex items-start justify-between gap-4">
              <dt class="text-gray-500">{{ row.label }}:</dt>
              <dd class="font-medium text-gray-900">{{ row.value }}</dd>
            </div>
          </dl>
        </article>

        <!-- Performance Summary -->
        <article class="w-full rounded-[10px] bg-white px-6 py-5 shadow-[0_8px_24px_rgba(0,0,0,0.08)] lg:w-1/2">
          <h2 class="text-[14px] font-semibold text-gray-900">Performance Summary</h2>

          <div class="mt-4 flex flex-col gap-4 text-[12px]">
            <div *ngFor="let p of performance">
              <div class="flex items-center justify-between font-medium text-gray-700">
                <span>{{ p.label }}</span>
                <span>{{ p.value }}</span>
              </div>

              <div class="mt-2 h-2 w-full rounded-full bg-gray-200">
                <div class="h-2 rounded-full" [ngClass]="p.color" [style.width]="p.width"></div>
              </div>
            </div>
          </div>
        </article>
      </div>
    </ng-container>

    <!-- ========================= STUDENTS TAB ========================= -->
    <ng-container *ngIf="activeTabKey === 'students'">
      <article class="mt-6 overflow-hidden rounded-[10px] border border-gray-100 bg-white shadow-[0_10px_26px_rgba(0,0,0,0.10)]">
        <div class="px-6 py-4">
          <h2 class="text-[14px] font-semibold text-gray-900">Student Attempts</h2>
        </div>
        <div class="h-px bg-gray-100"></div>

        <div class="w-full overflow-x-auto">
          <table class="w-full min-w-[880px]">
            <thead>
              <tr class="text-left text-[11px] font-medium text-gray-400">
                <th class="px-6 py-3">Student</th>
                <th class="px-6 py-3">Status</th>
                <th class="px-6 py-3">Score</th>
                <th class="px-6 py-3">Time Spent</th>
                <th class="px-6 py-3">Attempt Date</th>
                <th class="px-6 py-3 text-center">Actions</th>
              </tr>
            </thead>

            <tbody class="text-[12px] text-gray-700">
              <tr
                *ngFor="let s of studentAttempts; let last = last"
                class="bg-white"
                [ngClass]="!last ? 'border-b border-gray-100' : ''"
              >
                <td class="px-6 py-4">
                  <div class="flex items-center gap-3">
                    <img [src]="s.avatar" alt="Student" class="h-9 w-9 rounded-full object-cover" />
                    <div class="min-w-0">
                      <div class="font-semibold text-gray-900">{{ s.name }}</div>
                      <div class="mt-0.5 truncate text-[11px] text-gray-400">{{ s.email }}</div>
                    </div>
                  </div>
                </td>

                <td class="px-6 py-4">
                  <span
                    class="inline-flex items-center rounded-full px-3 py-1 text-[10px] font-semibold"
                    [ngClass]="statusPillClass(s.status)"
                  >
                    {{ s.status }}
                  </span>
                </td>

                <td class="px-6 py-4 font-semibold" [ngClass]="scoreColorClass(s.score)">
                  {{ s.score ?? '-' }}
                </td>
                <td class="px-6 py-4">{{ s.timeSpent ?? '-' }}</td>
                <td class="px-6 py-4">{{ s.attemptDate ?? '-' }}</td>

                <td class="px-6 py-4">
                  <div class="flex items-center justify-center gap-3">
                    <button
                      type="button"
                      aria-label="View"
                      (click)="viewStudentQuiz(s)"
                      class="inline-flex h-6 w-6 cursor-pointer items-center justify-center rounded-[6px]
                             transition-colors duration-150 hover:bg-gray-100
                             focus:outline-none focus:ring-2 focus:ring-[#8A3FFC]/25"
                    >
                      <img [src]="actionIcons.view" alt="View" class="h-3.5 w-3.5" />
                    </button>

                    <button
                      type="button"
                      aria-label="Message"
                      class="inline-flex h-6 w-6 cursor-pointer items-center justify-center rounded-[6px]
                             transition-colors duration-150 hover:bg-gray-100
                             focus:outline-none focus:ring-2 focus:ring-[#8A3FFC]/25"
                    >
                      <img [src]="actionIcons.mail" alt="Mail" class="h-3.5 w-3.5" />
                    </button>

                    <button
                      type="button"
                      aria-label="Profile"
                      (click)="StudentProfile(s)"
                      class="inline-flex h-6 w-6 cursor-pointer items-center justify-center rounded-[6px]
                             transition-colors duration-150 hover:bg-gray-100
                             focus:outline-none focus:ring-2 focus:ring-[#8A3FFC]/25"
                    >
                      <img [src]="actionIcons.profile" alt="Profile" class="h-3.5 w-3.5" />
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </article>
    </ng-container>

    <!-- ========================= QUESTIONS TAB ========================= -->
    <ng-container *ngIf="activeTabKey === 'questions'">
      <article class="mt-6 overflow-hidden rounded-[10px] border border-gray-100 bg-white shadow-[0_10px_26px_rgba(0,0,0,0.10)]">
        <div class="px-6 py-4">
          <h2 class="text-[14px] font-semibold text-gray-900">Quiz Questions</h2>
        </div>
        <div class="h-px bg-gray-100"></div>

        <div class="space-y-5 px-6 py-5">
          <section *ngFor="let q of questionsList" class="rounded-[10px] border border-gray-200 bg-white">
            <div class="flex items-start justify-between gap-4 px-5 py-4">
              <div class="min-w-0">
                <div class="text-[13px] font-semibold text-gray-900">{{ q.title }}</div>
                <p class="mt-2 text-[12px] text-gray-600">{{ q.prompt }}</p>
              </div>

              <span class="shrink-0 rounded-full bg-[#F4ECFF] px-3 py-1 text-[10px] font-semibold text-[#7C3AED]">
                {{ q.points }} points
              </span>
            </div>

            <div class="space-y-3 px-5 pb-5">
              <div
                *ngFor="let opt of q.options"
                class="flex items-center justify-between gap-4 rounded-[8px] border px-4 py-3"
                [ngClass]="optionRowClass(opt)"
              >
                <div class="flex items-center gap-3">
                  <span
                    class="inline-flex h-6 w-6 items-center justify-center rounded-full border text-[11px] font-semibold"
                    [ngClass]="opt.correct ? 'border-[#86EFAC] bg-white text-[#166534]' : 'border-gray-300 bg-white text-gray-600'"
                  >
                    {{ opt.key }}
                  </span>

                  <span class="text-[12px]" [ngClass]="optionTextClass(opt)">{{ opt.text }}</span>
                </div>

                <img *ngIf="opt.correct" [src]="questionIcons.check" alt="Correct" class="h-4 w-4" />
              </div>
            </div>
          </section>
        </div>
      </article>
    </ng-container>

    <!-- ========================= ANALYTICS TAB ========================= -->
    <ng-container *ngIf="activeTabKey === 'analytics'">
      <div class="mt-6 flex flex-col gap-6 lg:flex-row">
        <!-- Score Distribution -->
        <article class="w-full rounded-[10px] border border-gray-100 bg-white px-6 py-5 shadow-[0_10px_26px_rgba(0,0,0,0.10)] lg:w-1/2">
          <h2 class="text-[13px] font-semibold text-gray-900">Score Distribution</h2>

          <div class="mt-5 space-y-4">
            <div *ngFor="let r of scoreDistribution" class="flex items-center gap-4">
              <div class="w-[92px] text-[11px] text-gray-500">
                {{ r.label }}
              </div>

              <div class="flex-1">
                <div class="h-2 w-full rounded-full bg-gray-200">
                  <div class="h-2 rounded-full" [ngClass]="r.color" [style.width]="r.width"></div>
                </div>
              </div>

              <div class="w-6 text-right text-[11px] font-semibold text-gray-700">
                {{ r.count }}
              </div>
            </div>
          </div>
        </article>

        <!-- Question Analysis -->
        <article class="w-full rounded-[10px] border border-gray-100 bg-white px-6 py-5 shadow-[0_10px_26px_rgba(0,0,0,0.10)] lg:w-1/2">
          <h2 class="text-[13px] font-semibold text-gray-900">Question Analysis</h2>

          <div class="mt-5 space-y-5">
            <div *ngFor="let q of questionAnalysis">
              <div class="flex items-center justify-between">
                <div class="text-[11px] font-semibold text-gray-700">
                  {{ q.label }}
                </div>
                <div class="text-[11px] font-semibold text-[#F59E0B]">
                  {{ q.text }}
                </div>
              </div>

              <div class="mt-2 h-2 w-full rounded-full bg-gray-200">
                <div class="h-2 rounded-full bg-[#F59E0B]" [style.width]="q.width"></div>
              </div>
            </div>
          </div>
        </article>
      </div>
    </ng-container>

  </div>
</section>

