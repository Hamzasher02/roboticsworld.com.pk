<div class="min-h-screen bg-white">


    <!-- Error State -->
    <div *ngIf="!loading && error" class="mx-auto max-w-lg px-6 py-20 text-center">
        <div class="mb-6 flex justify-center">
            <div class="rounded-full bg-orange-50 p-6">
                <svg class="h-12 w-12 text-orange-400" xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
        </div>
        <h2 class="text-xl font-bold text-gray-900 mb-2">Notice</h2>
        <p class="text-gray-600 mb-8">{{error}}</p>
        <a routerLink="/student"
            class="inline-flex items-center justify-center rounded-md bg-[#FF6A3D] px-6 py-2 text-sm font-semibold text-white hover:bg-orange-600">
            Back to Dashboard
        </a>
    </div>

    <div class="mx-auto w-full max-w-[1200px] pb-10 pt-6 sm:px-6 lg:px-0" *ngIf="courseData && !loading">

        <!-- Back -->
        <a [routerLink]="['/student']"
            class="inline-flex items-center gap-3 text-[16px] font-semibold text-gray-900 sm:text-[18px] lg:text-[20px]">
            <span class="inline-flex h-6 w-6 items-center justify-center">
                <img src="assets/student/buy course/LeftArrow.svg" alt="Back" class="h-5 w-5" />
            </span>
            Back to Dashboard
        </a>

        <!-- Hero -->
        <section class="mt-8 sm:mt-10 lg:mt-12">
            <div
                class="relative w-full overflow-visible rounded-[2px] after:pointer-events-none after:absolute after:inset-0 after:rounded-[2px] after:border-[3px] after:border-[#880A73] after:-translate-y-[14px] after:translate-x-[14px] sm:after:-translate-y-[18px] sm:after:translate-x-[18px] lg:after:-translate-y-[20px] lg:after:translate-x-[20px] after:z-0 after:content-['']">
                <!-- Image card -->
                <div
                    class="relative z-10 overflow-hidden rounded-[2px] border border-gray-200 bg-white shadow-[0_2px_10px_rgba(0,0,0,0.08)]">
                    <img [src]="courseData.course.thumbnail || 'assets/student/courseImage/coursesDetail.svg'"
                        alt="Course banner" class="h-[180px] w-full object-cover sm:h-[240px] lg:h-[300px]" />
                </div>
            </div>

            <div class="mt-8 sm:mt-10">
                <h1 class="text-[20px] font-extrabold leading-tight text-gray-900
                 sm:text-[24px] lg:text-[28px]">
                    {{courseData.course.title}}
                </h1>

                <p class="mt-2 max-w-[980px] text-[12px] leading-4 text-gray-600 sm:text-[13px] sm:leading-5">
                    {{courseData.course.shortDescription || courseData.course.description}}
                </p>

                <!-- Progress -->
                <div>
                    <div class="text-[14px] font-bold text-gray-900 sm:text-[16px]">Course Progress</div>
                    <div class="text-[12px] font-semibold text-gray-700">{{courseProgress}}%</div>
                    <div class="h-2 w-full overflow-hidden rounded-full bg-gray-200">
                        <div class="h-full rounded-full bg-[#FF6A3D] transition-all duration-300"
                            [style.width.%]="courseProgress"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Instructor -->
        <section class="mt-3 sm:mt-8">
            <div
                class="rounded-[12px] border border-gray-200 bg-white px-4 py-5 sm:px-8 sm:py-6 shadow-[0_2px_10px_rgba(0,0,0,0.08)]">
                <div
                    class="flex flex-col gap-5 items-center text-center sm:items-start sm:text-left lg:flex-row lg:items-center lg:justify-between">
                    <!-- Left -->
                    <div class="flex flex-col items-center gap-3 sm:flex-row sm:items-center sm:gap-6">
                        <img [src]="courseData.course.instructor?.profilePicture || 'assets/student/studentHeader/studentProfile.svg'"
                            alt="Instructor"
                            class="h-[80px] w-[80px] rounded-full object-cover sm:h-[100px] sm:w-[100px]" />

                        <div>
                            <div class="text-[15px] font-semibold text-gray-900 sm:text-[17px]">
                                {{courseData.course.instructor?.firstName}} {{courseData.course.instructor?.lastName}}
                            </div>
                            <div class="mt-1 text-[12px] text-gray-500">
                                Course Instructor
                            </div>
                        </div>
                    </div>

                    <!-- Right -->
                    <div
                        class="grid gap-4 items-center justify-items-center sm:grid-cols-3 sm:gap-4 sm:items-start sm:justify-items-start lg:flex lg:flex-col lg:gap-3 lg:items-start lg:me-16">
                        <!-- Duration -->
                        <div class="flex items-center gap-5">
                            <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-gray-50">
                                <img src="assets/student/courseDemo/CalendarBlack.svg" alt="" class="h-5 w-5" />
                            </span>

                            <div>
                                <div class="text-[12px] font-medium text-gray-800">
                                    {{ (courseData.course.duration?.toLowerCase()?.includes('month')) ?
                                    courseData.course.duration : (courseData.course.duration ?
                                    courseData.course.duration + ' Months' : 'Duration TBD') }}
                                </div>
                            </div>

                            <div>
                                <div class="text-[10px] text-gray-500"></div>
                                <div class="text-[12px] font-medium text-gray-800">{{getClassDays()}}</div>
                            </div>
                        </div>

                        <!-- Time -->
                        <div class="flex items-center gap-3 sm:col-span-2 lg:col-span-1">
                            <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-gray-50">
                                <img src="assets/student/forum/ClockIcon.svg" alt="" class="h-5 w-5" />
                            </span>

                            <div>
                                <div class="text-[12px] font-medium text-gray-800">
                                    {{courseData.enrollment.preferredClassTime || 'Recordings Only'}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Live Sessions -->
        <section class="mt-6">
            <div class="flex flex-col gap-6 rounded-xl bg-gray-100 p-4 sm:p-6 lg:flex-row">
                <!-- Left -->
                <div class="flex-1 space-y-4 sm:ms-15">
                    <!-- Live Session Card Content -->
                    <div class="flex w-full flex-col items-start" *ngIf="upcomingSession; else noSession">

                        <!-- Row 1 -->
                        <div class="flex items-center gap-4">
                            <img src="assets/student/courseDemo/VideoCamera.svg" alt="" class="h-6 w-6" />
                            <h2 class="text[16px] sm:text-[20px] font-bold text-[#111827]">
                                {{upcomingSession.course.courseTitle || courseData.course.title}}
                            </h2>
                        </div>

                        <!-- Row 2 -->
                        <div class="mt-5 flex items-center gap-4">
                            <img src="assets/student/courseDemo/Calendar.svg" alt="" class="h-6 w-6" />
                            <p class="text[16px] sm:text-[20px] font-bold text-[#111827]">
                                {{upcomingSession.sessionDate | date:'mediumDate'}} at {{upcomingSession.startTime}}
                            </p>
                        </div>

                        <!-- Row 3 -->
                        <div class="mt-5 flex items-center gap-4">
                            <img src="assets/student/courseDemo/Clock.svg" alt="" class="h-6 w-6" />
                            <p class="text[16px] sm:text-[20px] font-bold text-[#FACC15]">
                                {{upcomingSession.sessionStatus | titlecase}}
                            </p>
                        </div>

                        <!-- Button -->
                        <a [href]="upcomingSession.sessionLink" target="_blank" type="button"
                            *ngIf="upcomingSession.sessionLink"
                            class="mt-7 flex h-[45px] sm:w-70 items-center justify-center gap-3 rounded-[2px] bg-[#FF6A3D] px-6 text-[15px] font-semibold text-white hover:bg-[#ff7a55]">
                            <img src="assets/student/forum/VideoCameraWhite.svg" alt="" class="h-5 w-5" />
                            Join Live Class
                        </a>

                    </div>
                    <ng-template #noSession>
                        <div class="flex w-full flex-col items-start">
                            <h2 class="text-[18px] font-bold text-gray-700">No upcoming live sessions scheduled.</h2>
                            <p class="text-gray-500 mt-2">Check back later for updates.</p>
                        </div>
                    </ng-template>

                </div>

                <!-- Zoom Details -->
                <!-- <div class="w-full rounded-lg bg-white p-4 shadow sm:p-6 lg:w-72">
                    <h3 class="text-[16px] font-bold sm:text-lg">Zoom Details</h3>
                    <p class="mt-2 text-[13px] sm:text-sm">Meeting ID: <b>123-456-789</b></p>
                    <p class="text-[13px] sm:text-sm">Passcode: <b>python123</b></p>
                </div> -->
            </div>
        </section>

        <!-- Course Lessons -->
        <section class="mt-8 sm:mt-10">
            <h2 class="text-[18px] font-extrabold text-gray-900 sm:text-[20px] lg:text-[22px]">
                Course Lessons
            </h2>

            <!-- Lesson List -->
            <div class="mt-5 space-y-6">
                <!-- Dynamic Modules Loop -->
                <div *ngFor="let module of courseData.modules; let i = index" class="mt-6 flex flex-col gap-4">
                    <!-- Module Item -->
                    <button type="button"
                        class="flex w-full items-center justify-between rounded-[12px] border px-4 py-4 shadow-[0_6px_14px_rgba(0,0,0,0.10)] sm:px-5 transition-all duration-300"
                        [ngClass]="getModuleClass(module)">

                        <div class="flex min-w-0 flex-1 items-center gap-4">
                            <!-- Index Box -->
                            <div
                                class="flex h-[54px] w-[54px] shrink-0 items-center justify-center rounded-[12px] bg-white shadow-[0_3px_10px_rgba(0,0,0,0.10)]">
                                <span class="text-[18px] sm:text-[22px] font-bold text-[#111827]">{{i + 1}}</span>
                            </div>

                            <!-- Content -->
                            <div class="min-w-0">
                                <div class="text-left text-[15px] sm:text-[16px] font-bold text-[#111827]">
                                    {{module.moduleName || module.title}}
                                </div>
                                <div *ngIf="module.moduleDescription || module.description"
                                    class="mt-1 text-left text-[12px] sm:text-[13px] leading-4 sm:leading-5 text-gray-500">
                                    {{module.moduleDescription || module.description}}
                                </div>
                            </div>
                        </div>

                        <!-- Checkmark (Only if completed) -->
                        <div *ngIf="module.completed || module.studentCompleted"
                            class="flex h-[36px] w-[36px] sm:h-[46px] sm:w-[46px] shrink-0 items-center justify-center rounded-full bg-white shadow-[0_3px_10px_rgba(0,0,0,0.12)]">
                            <img src="assets/student/courseImage/greenCheck.svg" class="h-5 w-5" alt="Completed" />
                        </div>
                    </button>

                    <!-- Quizzes Loop (filtered by module) -->
                    <button *ngFor="let quiz of getQuizzesForModule(module._id)" type="button"
                        (click)="handleQuizAction(quiz)"
                        class="flex w-full items-center justify-between rounded-[12px] border border-[#D8B4FE] bg-[#F5F3FF] px-4 py-2 shadow-[0_6px_14px_rgba(0,0,0,0.10)] sm:px-5 transition-all duration-300 hover:border-[#880A73]">

                        <div class="flex min-w-0 flex-1 items-center gap-4">
                            <!-- Quiz Icon -->
                            <div
                                class="flex h-[54px] w-[54px] shrink-0 items-center justify-center rounded-[12px] bg-white shadow-[0_3px_10px_rgba(0,0,0,0.10)]">
                                <img src="assets/student/courseImage/Quiz.svg" class="h-8 w-8" alt="Quiz" />
                            </div>

                            <!-- Quiz Info -->
                            <div class="min-w-0">
                                <span
                                    class="flex justitems-start  rounded-full w-fit bg-green-100 px-2.5 py-0.5 text-[10px] font-medium text-green-800 mb-1">
                                    Quiz
                                </span>
                                <div class="text-left w-full text-[15px] sm:text-[16px] font-bold text-[#111827]">
                                    {{quiz.title}}
                                </div>
                                <div class="flex justify-start mt-1 text-[11px] text-gray-600">
                                    <span *ngIf="quiz.totalQuestions">{{quiz.totalQuestions}} Questions</span>
                                    <span *ngIf="quiz.totalQuestions && quiz.totalPoints"> • </span>
                                    <span *ngIf="quiz.totalPoints">{{quiz.totalPoints}} Points</span>
                                    <span
                                        *ngIf="(quiz.totalQuestions || quiz.totalPoints) && getQuizStatus(quiz._id) !== 'Not Started'">
                                        • </span>
                                    <span class="font-semibold" [ngClass]="{
                                            'text-green-600': getQuizStatus(quiz._id) === 'Completed',
                                            'text-blue-600': getQuizStatus(quiz._id) === 'In Progress'
                                        }">
                                        {{getQuizStatus(quiz._id) !== 'Not Started' ? getQuizStatus(quiz._id) : ''}}
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- Right Side: Duration or Completed Status -->
                        <div class="flex shrink-0 items-center gap-2" *ngIf="getQuizStatus(quiz._id) === 'Completed'">
                            <span class="text-[12px] font-semibold text-green-600">Completed</span>
                        </div>
                        <div class="flex shrink-0 items-center gap-2 text-gray-500"
                            *ngIf="getQuizStatus(quiz._id) !== 'Completed' && quiz.settings?.timeLimitMinutes">
                            <img src="assets/student/forum/ClockIcon.svg" class="h-4 w-4" alt="Duration" />
                            <span class="text-[12px]">{{quiz.settings.timeLimitMinutes}} min</span>
                        </div>
                    </button>

                    <!-- Loading State -->
                    <div *ngIf="loadingQuizzes" class="flex justify-center py-4">
                        <div class="h-6 w-6 border-2 border-purple-200 border-t-purple-500 rounded-full animate-spin">
                        </div>
                    </div>

                    <!-- Empty State -->
                    <div *ngIf="!loadingQuizzes && courseQuizzes.length === 0"
                        class="text-center py-4 text-gray-500 text-sm">
                        No quizzes available for this course yet.
                    </div>
                </div>
            </div>
        </section>


        <!-- Course Resources -->
        <section class="mt-8 sm:mt-10">
            <h2 class="text-[18px] font-extrabold text-gray-900 sm:text-[22px] lg:text-[24px]">Course Resources</h2>

            <a [routerLink]="['/student/live-sessions', courseData.course._id, 'course-feedback']"
                class="block mt-5 rounded-[2px] bg-[#E8FFF0] px-5 py-6 sm:px-8 sm:py-8 hover:opacity-95">
                <div class="flex items-start gap-4">
                    <img src="assets/student/buy course/Comment.svg" alt="" class="h-9 w-9 sm:h-10 sm:w-10" />
                    <div>
                        <div class="text-[14px] font-extrabold text-gray-900">
                            Course Feedback
                        </div>
                        <div class="mt-1 text-[12px] text-gray-500">
                            Share your Thoughts
                        </div>
                    </div>
                </div>
            </a>

            <a [routerLink]="['/student/live-sessions', courseData.course._id, 'generate-certificate']"
                class="mt-6 sm:mt-8 flex h-[46px] w-full items-center justify-center rounded-[2px] bg-[#FDE2DB] text-[14px] font-bold text-gray-900 sm:h-[50px] sm:text-[16px]">
                Generate Certificate
            </a>

        </section>
        <router-outlet></router-outlet>
    </div>
</div>