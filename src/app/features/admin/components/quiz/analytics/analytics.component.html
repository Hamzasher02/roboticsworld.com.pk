<!-- analytics.component.html (Fully responsive + dynamic + pixel-accurate layout) -->
<section class="w-full bg-white p-4 sm:p-5">
  <!-- ===== Header Card ===== -->
  <div class="w-full rounded-[8px] border border-[#E9D5FF] bg-[#E9D5FF] px-4 py-3 sm:px-5">
    <div class="flex w-full flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
      <div class="flex flex-col">
        <h2 class="text-[13px] font-semibold leading-[18px] text-[#6B21A8] sm:text-[14px]">
          Analytics for: {{ quizTitle }}
        </h2>
        <p class="mt-[2px] text-[11px] leading-[14px] text-[#923D8C] opacity-80 sm:text-[12px]">
          {{ headerSubtitle }}
        </p>
      </div>

      <button
        type="button"
        (click)="viewAllQuizzes()"
        class="cursor-pointer flex h-[28px] w-full items-center justify-center rounded-xl border border-[#923D8C] bg-white px-3 text-[11px] font-medium text-[#923D8C] sm:w-auto"
      >
        View All Quizzes
      </button>
    </div>
  </div>

  <!-- ===== Controls Row ===== -->
  <div class="mt-2 w-full rounded-[8px] bg-[#F9FAFB] px-4 py-3 sm:px-5">
    <div class="flex w-full flex-col gap-3 md:flex-row md:items-end md:justify-between md:gap-4">
      <div class="flex w-full flex-col gap-3 md:flex-row md:items-end md:gap-6">
        <!-- Select Quiz -->
        <div class="flex w-full flex-col md:w-[280px]">
          <label class="mb-1 text-[11px] font-semibold text-[#111827]">Select Quiz</label>
          <div class="relative flex w-full items-center">
            <select
              [(ngModel)]="selectedQuiz"
              aria-label="Select Quiz"
              class="h-[34px] w-full appearance-none rounded-[6px] border border-[#D1D5DB] bg-[#F3F4F6] px-3 pr-9
                     text-[12px] font-medium text-[#111827] outline-none focus:border-[#C4B5FD]"
            >
              <option *ngFor="let q of quizzes" [value]="q">{{ q }}</option>
            </select>

            <svg class="pointer-events-none absolute right-3 h-4 w-4 text-[#6B7280]" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path
                fill-rule="evenodd"
                d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 1 1 1.06 1.06l-4.24 4.24a.75.75 0 0 1-1.06 0L5.21 8.29a.75.75 0 0 1 .02-1.08Z"
                clip-rule="evenodd"
              />
            </svg>
          </div>
        </div>

        <!-- Date Range -->
        <div class="flex w-full flex-col md:w-[280px]">
          <label class="mb-1 text-[11px] font-semibold text-[#111827]">Date Range</label>
          <div class="relative flex w-full items-center">
            <select
              [(ngModel)]="selectedRange"
              aria-label="Date Range"
              class="h-[34px] w-full appearance-none rounded-[6px] border border-[#D1D5DB] bg-[#F3F4F6] px-3 pr-9
                     text-[12px] font-medium text-[#111827] outline-none focus:border-[#C4B5FD]"
            >
              <option *ngFor="let r of dateRanges" [value]="r">{{ r }}</option>
            </select>

            <svg class="pointer-events-none absolute right-3 h-4 w-4 text-[#6B7280]" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path
                fill-rule="evenodd"
                d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 1 1 1.06 1.06l-4.24 4.24a.75.75 0 0 1-1.06 0L5.21 8.29a.75.75 0 0 1 .02-1.08Z"
                clip-rule="evenodd"
              />
            </svg>
          </div>
        </div>
      </div>

      <!-- Export -->
      <button
        type="button"
        (click)="exportReport()"
        class="cursor-pointer flex h-[34px] w-full items-center justify-center gap-2 rounded-[6px] bg-[#923D8C] px-4 text-[12px] font-semibold text-white md:w-[340px]"
        aria-label="Export Report"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 3v10m0 0 4-4m-4 4-4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          <path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
        Export Report
      </button>
    </div>
  </div>

  <!-- ===== Stats Cards ===== -->
<div class="mt-4 flex w-full flex-col gap-3 sm:flex-row sm:flex-wrap sm:gap-4">
  <article
    *ngFor="let card of statCards"
    class="flex w-full flex-col justify-between rounded-[10px] border border-[#E5E7EB] bg-white px-5 py-4
           sm:w-[calc(50%-8px)]
           md:w-[calc(33.333%-10.67px)]
           lg:w-[calc(25%-12px)]"
  >
    <div class="flex w-full items-start justify-between">
      <div class="flex flex-col">
        <p class="text-[11px] font-medium text-[#6B7280]">{{ card.label }}</p>
        <p class="mt-1 text-[20px] font-semibold leading-6 text-[#111827]">
          {{ card.value }}
        </p>
      </div>

      <div
        class="flex h-9 w-9 items-center justify-center rounded-[8px]"
        [ngClass]="statIconBg(card.tone)"
      >
        <!-- user -->
        <svg
          *ngIf="card.icon==='user'"
          xmlns="http://www.w3.org/2000/svg"
          class="h-[18px] w-[18px]"
          [ngClass]="statIconColor(card.tone)"
          viewBox="0 0 24 24"
          fill="none"
          aria-hidden="true"
        >
          <path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Z" stroke="currentColor" stroke-width="2" />
          <path d="M20 20a8 8 0 1 0-16 0" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>

        <!-- trophy -->
        <svg
          *ngIf="card.icon==='trophy'"
          class="h-[18px] w-[18px]"
          [ngClass]="statIconColor(card.tone)"
          viewBox="0 0 24 24"
          fill="none"
          aria-hidden="true"
        >
          <path d="M3 7h2v6H3z" fill="currentColor" />
          <path d="M19 7h2v6h-2z" fill="currentColor" />
          <path d="M6 5h12v5c0 4-3 7-6 7s-6-3-6-7V5z" stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
          <path d="M12 17v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          <path d="M8 21h8" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>

        <!-- check -->
        <svg
          *ngIf="card.icon==='check'"
          xmlns="http://www.w3.org/2000/svg"
          class="h-[18px] w-[18px]"
          [ngClass]="statIconColor(card.tone)"
          viewBox="0 0 24 24"
          fill="none"
          aria-hidden="true"
        >
          <path d="m7 12 3 3 7-7" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>

        <!-- clock -->
        <svg
          *ngIf="card.icon==='clock'"
          xmlns="http://www.w3.org/2000/svg"
          class="h-[18px] w-[18px]"
          [ngClass]="statIconColor(card.tone)"
          viewBox="0 0 24 24"
          fill="none"
          aria-hidden="true"
        >
          <path d="M12 22a10 10 0 1 0-10-10 10 10 0 0 0 10 10Z" stroke="currentColor" stroke-width="2" />
          <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </div>
    </div>

    <p class="mt-3 text-[11px] font-medium" [ngClass]="deltaTextClass(card.deltaTone)">
      {{ card.deltaText }}
    </p>
  </article>
</div>


  <!-- ===== Distribution + Patterns ===== -->
  <div class="mt-5 flex w-full flex-col gap-5 lg:flex-row">
    <!-- Score Distribution -->
    <article class="flex w-full flex-col rounded-[10px] border border-[#E5E7EB] bg-white p-6 lg:w-1/2">
      <h3 class="text-[13px] font-semibold text-[#111827]">Score Distribution</h3>

      <div class="mt-4 flex w-full flex-col gap-4">
        <div *ngFor="let row of scoreDistribution" class="flex w-full items-center">
          <div class="w-[86px] text-[11px] font-medium text-[#6B7280]">{{ row.label }}</div>

          <div class="ml-6 flex flex-1 items-center">
            <div class="h-[8px] flex-1 rounded-full bg-[#E5E7EB]">
              <div class="h-[8px] rounded-full" [style.width.%]="row.percent" [style.backgroundColor]="row.barColor"></div>
            </div>
            <div class="ml-4 w-[32px] text-right text-[11px] font-semibold text-[#111827]">
              {{ row.percent }}%
            </div>
          </div>
        </div>
      </div>
    </article>

    <!-- Attempt Patterns -->
    <article class="flex w-full flex-col rounded-[10px] border border-[#E5E7EB] bg-white p-6 lg:w-1/2">
      <h3 class="text-[13px] font-semibold text-[#111827]">Attempt Patterns</h3>

      <div class="mt-4 flex w-full flex-col gap-3">
        <div *ngFor="let item of attemptPatterns" class="flex w-full items-center justify-between rounded-[10px] bg-[#F9FAFB] px-4 py-4">
          <div class="flex flex-col">
            <p class="text-[12px] font-semibold text-[#111827]">{{ item.title }}</p>
            <p class="mt-0.5 text-[10px] font-medium text-[#6B7280]">{{ item.subtitle }}</p>
          </div>
          <p class="text-[12px] font-semibold" [style.color]="item.valueColor">{{ item.value }}</p>
        </div>
      </div>
    </article>
  </div>

  <!-- ===== Question-Level Performance ===== -->
  <section class="mt-5 w-full overflow-hidden rounded-[10px] border border-[#E5E7EB] bg-white">
    <div class="flex w-full flex-col px-6 py-5">
      <h2 class="text-[13px] font-semibold text-[#111827]">Question-Level Performance</h2>
      <p class="mt-1 text-[11px] font-medium text-[#6B7280]">Detailed analysis for JavaScript Fundamentals</p>
    </div>

    <div class="h-px w-full bg-[#EEF2F7]"></div>

    <div class="w-full overflow-x-auto">
      <table class="w-full min-w-[860px]">
        <thead>
          <tr class="bg-[#F9FAFB]">
            <th class="px-6 py-3 text-left text-[10px] font-semibold text-[#6B7280]">Question</th>
            <th class="px-4 py-3 text-left text-[10px] font-semibold text-[#6B7280]">Type</th>
            <th class="px-4 py-3 text-left text-[10px] font-semibold text-[#6B7280]">Correct Rate</th>
            <th class="px-4 py-3 text-left text-[10px] font-semibold text-[#6B7280]">Avg. Time</th>
            <th class="px-4 py-3 text-left text-[10px] font-semibold text-[#6B7280]">Difficulty</th>
            <th class="px-6 py-3 text-center text-[10px] font-semibold text-[#6B7280]">Actions</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let row of questionRows" class="border-t border-[#EEF2F7]">
            <td class="px-6 py-4">
              <div class="flex flex-col">
                <p class="text-[12px] font-semibold text-[#111827]">{{ row.title }}</p>
                <p class="mt-1 text-[10px] font-medium text-[#6B7280]">{{ row.subtitle }}</p>
              </div>
            </td>

            <td class="px-4 py-4">
              <span class="inline-flex items-center rounded-full px-3 py-1 text-[10px] font-semibold" [ngClass]="typeBadgeClass(row.typeTone)">
                {{ row.type }}
              </span>
            </td>

            <td class="px-4 py-4">
              <div class="flex items-center gap-3">
                <div class="h-[6px] w-[78px] rounded-full bg-[#E5E7EB]">
                  <div class="h-[6px] rounded-full" [style.width.%]="row.correctRate" [style.backgroundColor]="row.correctBarColor"></div>
                </div>
                <span class="text-[11px] font-semibold text-[#111827]">{{ row.correctRate }}%</span>
              </div>
            </td>

            <td class="px-4 py-4">
              <span class="text-[11px] font-medium text-[#111827]">{{ row.avgTime }}</span>
            </td>

            <td class="px-4 py-4">
              <span class="inline-flex items-center rounded-full px-3 py-1 text-[10px] font-semibold" [ngClass]="difficultyBadgeClass(row.difficultyTone)">
                {{ row.difficulty }}
              </span>
            </td>

            <td class="px-6 py-4">
              <div class="flex w-full items-center justify-center">
                <button
                  type="button"
                  (click)="viewQuestion(row)"
                  aria-label="View"
                  class="cursor-pointer flex h-8 w-8 items-center justify-center rounded-full hover:bg-[#F3F4F6]"
                >
                  <svg class="h-4 w-4 text-[#8B3C8A]" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M2.5 12s3.5-6 9.5-6 9.5 6 9.5 6-3.5 6-9.5 6-9.5-6-9.5-6Z" stroke="currentColor" stroke-width="2" />
                    <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" stroke="currentColor" stroke-width="2" />
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- ===== Bottom Two Panels ===== -->
  <section class="mt-5 w-full">
    <div class="flex w-full flex-col gap-5 lg:flex-row">
      <!-- Top Performing -->
      <article class="flex w-full flex-col rounded-[10px] border border-[#E5E7EB] bg-white p-5 lg:w-1/2">
        <h3 class="text-[12px] font-semibold text-[#111827]">Top Performing Quizzes</h3>

        <div class="mt-4 flex w-full flex-col gap-3">
          <div *ngFor="let item of topPerforming" class="flex w-full items-center justify-between rounded-[10px] px-4 py-3" [style.backgroundColor]="item.bg">
            <div class="flex min-w-0 flex-col">
              <p class="truncate text-[11px] font-semibold text-[#111827]">{{ item.title }}</p>
              <p class="mt-1 text-[9px] font-medium text-[#6B7280]">{{ item.meta }}</p>
            </div>

            <div class="flex flex-col items-end">
              <p class="text-[11px] font-semibold" [style.color]="item.gradeColor">{{ item.grade }}</p>
              <p class="mt-1 text-[9px] font-medium text-[#6B7280]">{{ item.avg }}</p>
            </div>
          </div>
        </div>
      </article>

      <!-- Improvements -->
      <article class="flex w-full flex-col rounded-[10px] border border-[#E5E7EB] bg-white p-5 lg:w-1/2">
        <h3 class="text-[12px] font-semibold text-[#111827]">Areas for Improvement</h3>

        <div class="mt-4 flex w-full flex-col gap-3">
          <div *ngFor="let item of improvements" class="flex w-full items-center justify-between rounded-[10px] bg-[#F9FAFB] px-4 py-3">
            <div class="flex min-w-0 flex-col">
              <p class="truncate text-[11px] font-semibold text-[#111827]">{{ item.title }}</p>
              <p class="mt-1 text-[9px] font-medium text-[#6B7280]">{{ item.subtitle }}</p>
            </div>

            <div class="flex flex-col items-end">
              <p class="text-[11px] font-semibold" [style.color]="item.valueColor">{{ item.value }}</p>
              <p class="mt-1 text-[9px] font-medium text-[#6B7280]">{{ item.unit }}</p>
            </div>
          </div>
        </div>
      </article>
    </div>
  </section>
</section>
