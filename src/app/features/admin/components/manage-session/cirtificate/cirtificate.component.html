<!-- cirtificate.component.html -->
<div class="fixed inset-0 z-[9999] flex items-center justify-center bg-black/20 px-4 py-6"
  (click)="!isProcessing && close()">
  <section
    class="flex w-full max-w-[980px] flex-col overflow-hidden rounded-[10px] border border-[#E5E7EB] bg-white shadow-[0_12px_30px_rgba(0,0,0,0.10)]"
    role="dialog" aria-modal="true" aria-label="Certificate Name Correction Request" (click)="$event.stopPropagation()">

    <!-- ✅ Header (sticky) -->
    <div
      class="sticky top-0 z-10 flex w-full items-center justify-between border-b border-[#EEF2F7] bg-white px-5 py-4">
      <h2 class="text-[15px] font-semibold text-[#111827]">
        Name Correction
      </h2>

      <button type="button" (click)="close()" aria-label="Close" [disabled]="isProcessing"
        [class.cursor-not-allowed]="isProcessing" [class.opacity-50]="isProcessing"
        [class.cursor-pointer]="!isProcessing"
        class="inline-flex h-8 w-8 items-center justify-center rounded-[8px] text-[#6B7280] hover:bg-[#F3F4F6] disabled:hover:bg-transparent">
        <svg viewBox="0 0 24 24" class="h-4 w-4" fill="none" aria-hidden="true">
          <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
      </button>
    </div>

    <!-- ✅ Scrollable body wrapper -->
    <div class="flex w-full flex-1 flex-col overflow-hidden">
      <!-- ✅ Scroll area (ONLY content scroll) -->
      <div class="flex w-full flex-1 flex-col gap-4 overflow-y-auto px-5 py-4 max-h-[calc(100vh-160px)]">

        <!-- Loading state for initial data fetch -->
        <div *ngIf="isLoading" class="flex h-32 items-center justify-center">
          <span class="h-8 w-8 animate-spin rounded-full border-4 border-[#8B3C8A] border-t-transparent"></span>
        </div>

        <!-- Processing overlay -->
        <div *ngIf="isProcessing"
          class="flex w-full flex-col items-center justify-center rounded-[8px] border border-[#8B3C8A] bg-[#F3E8FF] px-4 py-6">
          <span class="h-10 w-10 animate-spin rounded-full border-4 border-[#8B3C8A] border-t-transparent"></span>
          <div class="mt-3 text-[13px] font-semibold text-[#8B3C8A]">{{ processingText }}</div>
          <div class="mt-1 text-[11px] text-[#6B2C8A]">Please wait, do not close this window</div>
        </div>

        <!-- Name Correction Details -->
        <div *ngIf="!isLoading" class="flex w-full flex-col rounded-[8px] border border-[#EEF2F7] bg-white px-5 py-4"
          [class.opacity-50]="isProcessing" [class.pointer-events-none]="isProcessing">
          <div class="flex w-full items-center gap-2">
            <span class="flex h-4 w-4 items-center justify-center text-[#7C3AED]">
              <svg viewBox="0 0 24 24" class="h-4 w-4" fill="none" aria-hidden="true">
                <path d="M4 20h4l10.5-10.5a2 2 0 0 0 0-3L17.5 5a2 2 0 0 0-3 0L4 15.5V20Z" stroke="currentColor"
                  stroke-width="2" stroke-linejoin="round" />
                <path d="M13.5 6.5l4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
              </svg>
            </span>
            <div class="text-[12px] font-semibold text-[#111827]">Name Correction Details</div>
          </div>

          <div class="mt-4 flex w-full flex-col gap-4 md:flex-row md:items-start">
            <div class="flex w-full flex-col gap-2 md:flex-1">
              <label class="text-[10px] font-medium text-[#6B7280]">Current Name (from registration)</label>
              <input type="text" [value]="currentName" disabled
                class="h-[38px] w-full rounded-[6px] border border-[#FECACA] bg-[#FEF2F2] px-3 text-[12px] font-medium text-[#111827] outline-none disabled:opacity-100" />
            </div>

            <div class="flex w-full flex-col gap-2 md:flex-1">
              <label class="text-[10px] font-medium text-[#6B7280]">Requested Name (editable)</label>
              <input type="text" [(ngModel)]="form.requestedName" [disabled]="isProcessing"
                class="h-[38px] w-full rounded-[6px] border border-[#86EFAC] bg-[#ECFDF5] px-3 text-[12px] font-medium text-[#111827] outline-none focus:border-[#22C55E] disabled:opacity-60 disabled:cursor-not-allowed" />
            </div>
          </div>

          <div class="mt-4 flex w-full flex-col gap-2">
            <label class="text-[10px] font-medium text-[#6B7280]">Reason for Correction</label>
            <div class="flex w-full rounded-[6px] border border-[#BFDBFE] bg-[#EFF6FF] px-3 py-3">
              <textarea [(ngModel)]="form.reason" rows="2" readonly
                class="w-full resize-none bg-transparent text-[11px] font-medium text-[#1F2937] outline-none cursor-default"></textarea>
            </div>
          </div>
        </div>
      </div>

      <!-- ✅ Footer (sticky) -->
      <div
        class="sticky bottom-0 z-10 flex w-full items-center justify-between border-t border-[#EEF2F7] bg-white px-5 py-4">
        <button type="button" (click)="onCancel()" [disabled]="isProcessing" [class.cursor-not-allowed]="isProcessing"
          [class.opacity-50]="isProcessing" [class.cursor-pointer]="!isProcessing"
          class="inline-flex h-[34px] items-center justify-center gap-2 rounded-[8px] border border-[#E5E7EB] bg-white px-4 text-[12px] font-semibold text-[#111827] hover:bg-[#F3F4F6] disabled:hover:bg-white">
          <span class="flex h-4 w-4 items-center justify-center text-[#6B7280]">
            <svg viewBox="0 0 24 24" class="h-4 w-4" fill="none" aria-hidden="true">
              <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
          </span>
          Cancel
        </button>

        <div class="flex items-center gap-3">
          <!-- Reject Button -->
          <button type="button" (click)="onReject()" [disabled]="isProcessing" [class.cursor-not-allowed]="isProcessing"
            [class.opacity-50]="isProcessing && !isRejecting" [class.cursor-pointer]="!isProcessing"
            class="inline-flex h-[34px] items-center justify-center gap-2 rounded-[8px] border border-[#FCA5A5] bg-white px-4 text-[12px] font-semibold text-[#EF4444] hover:bg-[#FEF2F2] disabled:hover:bg-white transition-opacity">
            <span *ngIf="!isRejecting" class="flex h-4 w-4 items-center justify-center">
              <svg viewBox="0 0 24 24" class="h-4 w-4" fill="none" aria-hidden="true">
                <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
              </svg>
            </span>
            <span *ngIf="isRejecting"
              class="h-3 w-3 animate-spin rounded-full border-2 border-[#EF4444] border-t-transparent"></span>
            {{ isRejecting ? 'Rejecting...' : 'Reject Request' }}
          </button>

          <!-- Approve Button -->
          <button type="button" (click)="onApprove()" [disabled]="isProcessing"
            [class.cursor-not-allowed]="isProcessing" [class.opacity-70]="isProcessing && !isApproving"
            [class.cursor-pointer]="!isProcessing"
            class="inline-flex h-[34px] items-center justify-center gap-2 rounded-[8px] bg-gradient-to-r from-[#7C3AED] to-[#F97316] px-4 text-[12px] font-semibold text-white hover:opacity-95 disabled:hover:opacity-70 transition-opacity">
            <span *ngIf="!isApproving" class="flex h-4 w-4 items-center justify-center">
              <svg viewBox="0 0 24 24" class="h-4 w-4" fill="none" aria-hidden="true">
                <path d="M20 6 9 17l-5-5" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"
                  stroke-linejoin="round" />
              </svg>
            </span>
            <span *ngIf="isApproving"
              class="h-3 w-3 animate-spin rounded-full border-2 border-white border-t-transparent"></span>
            {{ isApproving ? 'Approving...' : 'Approve & Update Name' }}
          </button>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- ✅ Toast/Modal for success/error messages -->
<app-status-modal *ngIf="statusModal.show" [title]="statusModal.title" [message]="statusModal.message"
  [type]="statusModal.type" (close)="statusModal.show = false">
</app-status-modal>