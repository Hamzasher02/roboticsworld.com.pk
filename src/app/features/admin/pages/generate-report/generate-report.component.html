<!-- generate-report.component.html -->
<div class="min-h-screen w-full bg-white pl-4">
  <div class="mx-auto flex w-full max-w-[1440px] bg-[#F9FAFB] flex-col px-4 py-4 sm:px-6 sm:py-5 lg:px-8 lg:py-6">
    <!-- Title -->
    <h1 class="mt-3 text-[18px] font-semibold text-[#4B5563] sm:text-[22px] lg:text-[26px]">
      Report Generation
    </h1>

    <!-- Cards row (Responsive) -->
    <div class="mt-5 flex w-full flex-wrap items-stretch gap-3 sm:gap-4">
      <button
        *ngFor="let card of cards"
        type="button"
        (click)="open(card)"
        class="flex w-full cursor-pointer flex-col rounded-[12px] border border-[#E5E7EB] bg-white p-4 text-left
               transition-shadow duration-200
               hover:bg-[#F1EEEE] hover:shadow-[0_6px_16px_rgba(0,0,0,0.06)]
               sm:w-[calc(50%-8px)]
               lg:w-[calc(25%-12px)]
               xl:w-[calc(20%-13px)]"
      >
        <span
          class="flex h-[44px] w-[44px] items-center justify-center rounded-[10px]
                 shadow-[0_6px_14px_rgba(0,0,0,0.08)]"
          [style.background]="card.iconBg"
        >
          <img [src]="card.iconSrc" alt="" class="h-6 w-6 object-contain" draggable="false" />
        </span>

        <div class="mt-3 text-[14px] font-semibold text-[#111827] sm:text-[15px] lg:text-[16px]">
          {{ card.title }}
        </div>

        <div class="mt-1.5 text-[12px] leading-[17px] text-[#6B7280] sm:text-[13px] sm:leading-[18px]">
          {{ card.desc }}
        </div>
      </button>
    </div>

    <!-- Main area -->
    <div *ngIf="active" class="mt-5 flex w-full flex-col gap-4 lg:flex-row lg:items-start">
      <!-- LEFT: Configuration -->
      <section
        class="w-full rounded-[10px] bg-white p-4 shadow-[0_8px_18px_rgba(0,0,0,0.08)]
               lg:w-[380px] lg:shrink-0 lg:p-5"
      >
        <div class="flex w-full items-center justify-between gap-3">
          <h2 class="min-w-0 truncate text-[14px] font-semibold text-[#111827] sm:text-[15px] lg:text-[16px]">
            Report Configuration
          </h2>

          <button
            type="button"
            aria-label="Close"
            (click)="closeForm()"
            class="flex h-8 w-8 cursor-pointer items-center justify-center rounded-full text-[#6B7280] hover:bg-[#F3F4F6]"
          >
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M18 6 6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
          </button>
        </div>

        <!-- Report Type -->
        <div class="mt-4 flex w-full flex-col">
          <label class="text-[12px] font-semibold text-[#9CA3AF] sm:text-[13px]">Report Type</label>
          <select
            [(ngModel)]="form.reportType"
            class="mt-2 h-[40px] w-full cursor-pointer rounded-[8px] border border-[#D1D5DB] bg-white px-4 text-[12px] text-[#111827] outline-none"
          >
            <option *ngFor="let t of reportTypes" [value]="t">{{ t }}</option>
          </select>
        </div>

        <!-- Date Range -->
        <div class="mt-4 flex w-full flex-col">
          <div class="text-[12px] font-semibold text-[#9CA3AF] sm:text-[13px]">Date Range</div>

          <div class="mt-2 flex w-full flex-col gap-3 sm:flex-row sm:gap-4">
            <div class="flex w-full flex-col sm:w-1/2">
              <div class="text-[11px] text-[#6B7280]">From</div>
              <div class="mt-1.5 flex w-full items-center rounded-[8px] border border-[#D1D5DB] bg-white px-3">
                <input
                  type="date"
                  [(ngModel)]="form.from"
                  class="h-[34px] w-full cursor-pointer bg-transparent text-[12px] text-[#111827] outline-none"
                />
              </div>
            </div>

            <div class="flex w-full flex-col sm:w-1/2">
              <div class="text-[11px] text-[#6B7280]">To</div>
              <div class="mt-1.5 flex w-full items-center rounded-[8px] border border-[#D1D5DB] bg-white px-3">
                <input
                  type="date"
                  [(ngModel)]="form.to"
                  class="h-[34px] w-full cursor-pointer bg-transparent text-[12px] text-[#111827] outline-none"
                />
              </div>
            </div>
          </div>

          <div class="mt-3 flex w-full flex-wrap items-center gap-2">
            <button
              type="button"
              (click)="applyQuickRange('7')"
              class="h-[28px] cursor-pointer rounded-full bg-[#E8F0FF] px-3 text-[11px] text-[#111827] hover:bg-[#DDE9FF]"
            >
              Last 7 days
            </button>

            <button
              type="button"
              (click)="applyQuickRange('10')"
              class="h-[28px] cursor-pointer rounded-full bg-[#E8F0FF] px-3 text-[11px] text-[#111827] hover:bg-[#DDE9FF]"
            >
              Last 10 days
            </button>

            <button
              type="button"
              (click)="applyQuickRange('month')"
              class="h-[28px] cursor-pointer rounded-full bg-[#E8F0FF] px-3 text-[11px] text-[#111827] hover:bg-[#DDE9FF]"
            >
              Last Month
            </button>
          </div>
        </div>

        <!-- Filters -->
        <div class="mt-4 flex w-full flex-col">
          <div class="text-[12px] font-semibold text-[#9CA3AF] sm:text-[13px]">Filters</div>

          <div class="mt-3 flex w-full flex-col">
            <label class="text-[11px] font-medium text-[#6B7280]">Course Categories</label>
            <select
              [(ngModel)]="form.category"
              (change)="onCategoryChange()"
              class="mt-1.5 h-[40px] w-full cursor-pointer rounded-[8px] border border-[#D1D5DB] bg-white px-4 text-[12px] text-[#111827] outline-none"
            >
              <option *ngFor="let c of categories" [value]="c">{{ c }}</option>
            </select>
          </div>

          <div class="mt-3 flex w-full flex-col">
            <label class="text-[11px] font-medium text-[#6B7280]">Courses</label>
            <select
              [(ngModel)]="form.course"
              class="mt-1.5 h-[40px] w-full cursor-pointer rounded-[8px] border border-[#D1D5DB] bg-white px-4 text-[12px] text-[#111827] outline-none"
            >
              <option *ngFor="let c of filteredCourses" [value]="c">{{ c }}</option>
            </select>
          </div>

          <div *ngIf="active === 'instructor'" class="mt-3 flex w-full flex-col">
            <label class="text-[11px] font-medium text-[#6B7280]">Instructors</label>
            <select
              [(ngModel)]="form.instructor"
              class="mt-1.5 h-[40px] w-full cursor-pointer rounded-[8px] border border-[#D1D5DB] bg-white px-4 text-[12px] text-[#111827] outline-none"
            >
              <option *ngFor="let ins of instructors" [value]="ins">{{ ins }}</option>
            </select>
          </div>
        </div>

        <div class="mt-5 flex w-full items-center justify-end">
          <button
            type="button"
            (click)="generate()"
            class="h-[34px] cursor-pointer rounded-[8px] bg-[#7C3A8B] px-4 text-[11px] font-semibold text-white
                   shadow-[0_8px_18px_rgba(124,58,139,0.25)] hover:bg-[#6E337C]"
          >
            Generate Report
          </button>
        </div>
      </section>

      <!-- RIGHT: Preview (Fully responsive) -->
      <section
        *ngIf="showPreview && preview"
        class="w-full min-w-0 flex-1 overflow-hidden rounded-[10px] border border-[#E5E7EB] bg-white
               p-3 shadow-[0_10px_24px_rgba(0,0,0,0.08)] sm:p-4 lg:p-5"
      >
        <!-- Header -->
        <div class="flex w-full flex-wrap items-center justify-between gap-2">
          <h2 class="min-w-0 flex-1 truncate text-[13px] font-semibold text-[#111827] sm:text-[14px] lg:text-[15px]">
            {{ preview.title }}
          </h2>

          <button
            type="button"
            (click)="exportReport()"
            class="flex h-[28px] cursor-pointer items-center gap-2 rounded-[8px] bg-[#F3F4F6] px-3 text-[11px] font-medium text-[#374151] hover:bg-[#EDEFF2]"
          >
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M12 3v10m0 0 4-4m-4 4-4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M4 14v5h16v-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            Export
          </button>
        </div>

        <!-- Metrics: mobile stack / desktop row -->
        <div class="mt-4 flex w-full flex-col gap-3 sm:flex-row sm:items-stretch">
          <div
            *ngFor="let m of preview.metrics"
            class="flex w-full flex-col rounded-[8px] p-3 shadow-[0_6px_16px_rgba(0,0,0,0.08)] sm:w-1/3"
            [style.background]="m.bg"
          >
            <div class="flex w-full items-start justify-between gap-2">
              <div class="min-w-0 flex-1 truncate text-[11px] font-medium text-[#6B7280]">
                {{ m.label }}
              </div>

              <span class="flex h-6 w-6 items-center justify-center rounded-full bg-white/40">
                <svg *ngIf="m.icon === 'users'" class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M16 11a4 4 0 1 0-8 0" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                  <path d="M4 21a8 8 0 0 1 16 0" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
                <svg *ngIf="m.icon === 'clock'" class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M12 8v5l3 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                  <path d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" stroke="currentColor" stroke-width="2" />
                </svg>
                <svg *ngIf="m.icon === 'check'" class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="m6 12 4 4 8-8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                  <path d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" stroke="currentColor" stroke-width="2" opacity="0.35" />
                </svg>
              </span>
            </div>

            <div class="mt-1.5 text-[18px] font-bold text-[#111827] sm:text-[19px] lg:text-[20px]">
              {{ m.valueText }}
            </div>
            <div class="mt-1 text-[10px] leading-[13px] text-[#6B7280]">
              {{ m.subText }}
            </div>
          </div>
        </div>

        <!-- Chart: only scroll when needed -->
        <div class="mt-5 flex w-full flex-col">
          <div class="h-px w-full bg-[#EEF2F7]"></div>

          <div class="mt-3 w-full overflow-x-auto">
            <div class="min-w-[640px] sm:min-w-[680px]">
              <svg viewBox="0 0 900 260" class="h-[170px] w-full sm:h-[190px] lg:h-[205px]">
                <g opacity="0.55">
                  <line x1="40" y1="40" x2="880" y2="40" stroke="#E5E7EB" />
                  <line x1="40" y1="90" x2="880" y2="90" stroke="#E5E7EB" />
                  <line x1="40" y1="140" x2="880" y2="140" stroke="#E5E7EB" />
                  <line x1="40" y1="190" x2="880" y2="190" stroke="#E5E7EB" />
                  <line x1="40" y1="240" x2="880" y2="240" stroke="#E5E7EB" />
                </g>

                <path [attr.d]="areaPath" [attr.fill]="preview.chartArea" opacity="0.7"></path>

                <path
                  [attr.d]="linePath"
                  fill="none"
                  [attr.stroke]="preview.chartLine"
                  stroke-width="2.2"
                  stroke-linecap="round"
                ></path>

                <g [attr.fill]="preview.chartLine">
                  <circle *ngFor="let p of points" [attr.cx]="p.x" [attr.cy]="p.y" r="2.8"></circle>
                </g>

                <g font-size="10" fill="#6B7280">
                  <text *ngFor="let xt of xTicks" [attr.x]="xt.x" y="255" text-anchor="middle">{{ xt.label }}</text>
                </g>

                <g font-size="10" fill="#111827">
                  <text *ngFor="let yt of yTicks; let i = index" x="18" [attr.y]="44 + i*50">{{ yt }}</text>
                </g>
              </svg>
            </div>
          </div>
        </div>

        <!-- Donut + Table: mobile stack / desktop row -->
        <div class="mt-5 flex w-full flex-col">
          <h3 class="text-[13px] font-semibold text-[#111827] sm:text-[14px] lg:text-[15px]">
            {{ preview.donutTitle }}
          </h3>

          <div class="mt-3 flex w-full flex-col gap-4 lg:flex-row lg:items-start">
            <!-- Donut + legend -->
            <div class="flex w-full flex-col sm:flex-row sm:items-center sm:gap-6 lg:w-[55%]">
              <div class="flex w-full items-center justify-center sm:w-[200px] sm:justify-start">
                <svg width="140" height="140" viewBox="0 0 42 42" class="h-[140px] w-[140px] sm:h-[150px] sm:w-[150px]">
                  <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#E5E7EB" stroke-width="6"></circle>

                  <circle
                    *ngFor="let seg of donutSegments"
                    cx="21"
                    cy="21"
                    r="15.915"
                    fill="transparent"
                    [attr.stroke]="seg.color"
                    stroke-width="6"
                    [attr.stroke-dasharray]="seg.dasharray"
                    [attr.stroke-dashoffset]="seg.dashoffset"
                  ></circle>

                  <circle cx="21" cy="21" r="10.5" fill="#FFFFFF"></circle>
                </svg>
              </div>

              <div class="mt-3 flex w-full flex-col gap-2 sm:mt-0 sm:w-auto">
                <div *ngFor="let l of donutLegend" class="flex items-center gap-2">
                  <span class="h-2.5 w-2.5 shrink-0 rounded-full" [style.background]="l.dot"></span>
                  <span class="min-w-0 truncate text-[12px] font-semibold text-[#111827]">{{ l.label }}</span>
                </div>
              </div>
            </div>

            <!-- Table -->
            <div class="flex w-full flex-col lg:w-[45%]">
              <div class="flex w-full overflow-hidden rounded-[8px] border border-[#E5E7EB]">
                <div class="flex w-full items-center bg-[#F9FAFB] px-3 py-2">
                  <div class="flex w-full items-center">
                    <div
                      *ngFor="let c of preview.tableColumns; let i = index"
                      class="min-w-0 truncate text-[11px] font-semibold text-[#111827]"
                      [class.w-[46%]]="i === 0"
                      [class.w-[18%]]="i !== 0"
                      [class.text-right]="i !== 0"
                    >
                      {{ c }}
                    </div>
                  </div>
                </div>
              </div>

              <div class="mt-2 flex w-full flex-col overflow-hidden rounded-[8px] border border-[#E5E7EB]">
                <div
                  *ngFor="let r of preview.tableRows; let last = last"
                  class="flex w-full items-center px-3 py-2.5"
                  [class.border-b]="!last"
                  [class.border-[#EEF2F7]]="!last"
                >
                  <div class="flex w-full items-center">
                    <div class="min-w-0 w-[46%] truncate text-[11px] text-[#111827]">{{ r.values[0] }}</div>

                    <ng-container *ngFor="let v of r.values; let idx = index">
                      <div *ngIf="idx !== 0" class="min-w-0 w-[18%] truncate text-right text-[11px] text-[#111827]">
                        {{ v }}
                      </div>
                    </ng-container>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>
